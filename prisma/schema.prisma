// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "cockroachdb"
  url      = env("DATABASE_URL")
}

model User {
  id String @id // google id of the user
  email String
  discordBotAuth Boolean @default(false)
  notionAuths NotionAuth[]
  features Feature[]
}

model NotionAuth {
  botId String @id
  accessToken String
  owner String
  duplicatedTemplateId String
  workspaceIcon String
  workspaceId String
  workspaceName String
  user User @relation(fields: [userId], references: [id])
  userId String
  discordUsers DiscordUser[]
  guildName String?
}

model DiscordUser {
  username String @id
  notionAuth NotionAuth @relation(fields: [notionAuthId], references: [botId])
  notionAuthId String
}

model Feature {
  id Int @id @default(sequence())
  title String
  description String
  columnState Int
  rankState Int
  user User @relation(fields: [userId], references: [id])
  userId String
  textBox TextBox?
}

model TextBox {
    id                Int      @id @default(sequence())
    serializedContent String
    localUpdatedAt    DateTime @default(now())
    feature Feature? @relation(fields: [featureId], references: [id])
    featureId Int @unique()
}
